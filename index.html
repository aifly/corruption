<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width,initial-scale=1.0,user-scalable=no'/>
    <title>2016年以来的反腐弹窗推送</title>
    <script>
        document.querySelector('html').style.fontSize = document.documentElement.clientWidth / 10 + 'px';    
        document.addEventListener('touchmove',function(e){e.preventDefault()})
    </script>

    <style>
    .fly-loading-C{position:absolute;left:0;top:0;width:100%;height:100%;
            background:url(./assets/images/loading-bg.jpg) no-repeat center center;
            background-size:cover
        }
    .fly-loading-C.hide{-webkit-transition:1s;transition:1s;opacity:0;z-index:-1}
    .l-loading-scale{
        position:absolute;top:50%;
        color:#fff;
        width:100%;
        font-size:20px;
        font-family:Georgia;
        text-align:center;
        margin-top:.4rem;
        
    }
    </style>
</head>
<body style="overflow: hidden;">

<div class="fly-loading-C">
    <canvas id="loading"></canvas>
    <div class='l-loading-scale' id='l-loading-scale'></div>
</div>

<div id="fly-main">
</div>
<script>

function Vector2(x, y) {

    this.x = x || 0;
    this.y = y || 0;

};


Vector2.prototype = {
  
    constructor: Vector2,

    set: function (x, y) {

        this.x = x;
        this.y = y;

        return this;

    },

    copy: function (v) {

        this.x = v.x;
        this.y = v.y;

        return this;

    },

    clone: function () {

        return new THREE.Vector2(this.x, this.y);

    },


    add: function (v1, v2) {

        this.x = v1.x + v2.x;
        this.y = v1.y + v2.y;

        return this;

    },

    addSelf: function (v) {

        this.x += v.x;
        this.y += v.y;

        return this;

    },

    sub: function (v1, v2) {

        this.x = v1.x - v2.x;
        this.y = v1.y - v2.y;

        return this;

    },

    subSelf: function (v) {

        this.x -= v.x;
        this.y -= v.y;

        return this;

    },

    multiplyScalar: function (s) {

        this.x *= s;
        this.y *= s;

        return this;

    },

    divideScalar: function (s) {

        if (s) {

            this.x /= s;
            this.y /= s;

        } else {

            this.set(0, 0);

        }

        return this;

    },


    negate: function () {

        return this.multiplyScalar(-1);

    },

    dot: function (v) {

        return this.x * v.x + this.y * v.y;

    },

    lengthSq: function () {

        return this.x * this.x + this.y * this.y;

    },

    length: function () {

        return Math.sqrt(this.lengthSq());

    },

    normalize: function () {

        return this.divideScalar(this.length());

    },

    distanceTo: function (v) {
        return Math.sqrt(this.distanceToSquared(v));
    },

    distanceToSquared: function (v) {
        var dx = this.x - v.x, dy = this.y - v.y;
        return dx * dx + dy * dy;
    },


    setLength: function (l) {

        return this.normalize().multiplyScalar(l);

    },

    equals: function (v) {

        return ((v.x === this.x) && (v.y === this.y));

    },
    rotateSelf: function (p, theta) {
        var v = new Vector2();
      
        v.sub(this, p);
        theta *= Math.PI / 180;
        var R = [[Math.cos(theta), -Math.sin(theta)], [Math.sin(theta), Math.cos(theta)]];
        this.x = p.x + R[0][0] * v.x + R[0][1] * v.y;
        this.y = p.y + R[1][0] * v.x + R[1][1] * v.y;
    },
    
 
    reflectionSelf: function (v) {
        var nv = v.normalize();
        this.subSelf(nv.multiplyScalar(2 * this.dot(nv)));
    },
    distanceToLine: function (p1, p2) {
        if (p2.x === p1.x) {
            return Math.abs(this.y - p1.y);
        }
        else if (p2.y === p1.y) {
            return Math.abs(this.x - p1.x);
        }
        else {
            var A = (p2.y - p1.y) / (p2.x - p1.x);
            var B = -1;
            var C = p1.y - A * p1.x;
            return Math.abs(A * this.x + B * this.y + C) / Math.sqrt(A * A + B * B);
        }
    },
    vertical: function () {
        return new Vector2(-this.y, this.x);
    }

};


Vector2.sub = function (v1, v2) {
    return new Vector2(v1.x - v2.x, v1.y - v2.y)
}


Vector2.rotate = function (p1, p2, theta) {
    var v = new Vector2();
    v.sub(p1, p2);
    theta *= Math.PI / 180;
    var R = [ [Math.cos(theta), -Math.sin(theta)],  [Math.sin(theta), Math.cos(theta)] ];
    return new Vector2(p2.x + R[0][0] * v.x + R[0][1] * v.y, p2.y + R[1][0] * v.x + R[1][1] * v.y);
}

</script>
<script>
 !function(document){

        function Word(text, fontSize, color, position) {
            this.text = text;
            this.fontSize = fontSize;
            this.color = color;
            this.position = position;
        }
        var size = setSize();
        var y = size.viewHeight / 2;
        var x = (size.viewWidth - 180 ) / 2;

        var textL = new Word("L", 40, "#ffffff", new Vector2(x, y));
        var textO = new Word("o", 40, "#ffffff", new Vector2(x+20, y));
        var textA = new Word("a", 40, "#ffffff", new Vector2(x+40, y));
        var textD = new Word("d", 40, "#ffffff", new Vector2(x+60, y));
        var textI = new Word("i", 40, "#ffffff", new Vector2(x+80, y));
        var textN = new Word("n", 40, "#ffffff", new Vector2(x+100, y));
        var textG = new Word("g", 40, "#ffffff", new Vector2(x+120, y));
        var textPoint1 = new Word(".", 40, "#ffffff", new Vector2(x+140, y));
        var textPoint2 = new Word(".", 40, "#ffffff", new Vector2(x+160, y));
        var textPoint3 = new Word(".", 40, "#ffffff", new Vector2(x+180, y));

        var text = [];
        text.push(textL);
        text.push(textO);
        text.push(textA);
        text.push(textD);
        text.push(textI);
        text.push(textN);
        text.push(textG);
        text.push(textPoint1);
        text.push(textPoint2);
        text.push(textPoint3);

        var c = document.getElementById('loading');
        var cxt = c.getContext("2d");
        cxt.fillStyle = "#fff";
        function drawAllWords() {
            cxt.font = "bolder " + textL.fontSize + "px 宋体";
            cxt.fillText(textL.text, textL.position.x, textL.position.y);
            cxt.font = "bolder " + textO.fontSize + "px 宋体";
            cxt.fillText(textO.text, textO.position.x, textO.position.y);
            cxt.font = "bolder " + textA.fontSize + "px 宋体";
            cxt.fillText(textA.text, textA.position.x, textA.position.y);
            cxt.font = "bolder " + textD.fontSize + "px 宋体";
            cxt.fillText(textD.text, textD.position.x, textD.position.y);
            cxt.font = "bolder " + textI.fontSize + "px 宋体";
            cxt.fillText(textI.text, textI.position.x, textI.position.y);
            cxt.font = "bolder " + textN.fontSize + "px 宋体";
            cxt.fillText(textN.text, textN.position.x, textN.position.y);
            cxt.font = "bolder " + textG.fontSize + "px 宋体";
            cxt.fillText(textG.text, textG.position.x, textG.position.y);
            cxt.font = "bolder " + textPoint1.fontSize + "px 宋体";
            cxt.fillText(textPoint1.text, textPoint1.position.x, textPoint1.position.y);
            cxt.font = "bolder " + textPoint2.fontSize + "px 宋体";
            cxt.fillText(textPoint2.text, textPoint2.position.x, textPoint2.position.y);
            cxt.font = "bolder " + textPoint3.fontSize + "px 宋体";
            cxt.fillText(textPoint3.text, textPoint3.position.x, textPoint3.position.y);
        }

        var currentMap = 0;

        var isStop = false;

        function render(){
            cxt.clearRect(0, 0, c.width, c.height);
            drawAllWords();
            if (currentMap > 395) currentMap = 0;
            currentMap += 5;
            if (parseInt(currentMap / 40) <= text.length - 1) {
                text[parseInt(currentMap / 40)].fontSize = 60 - currentMap % 40;

            }
            if (parseInt(currentMap / 40) + 1 <= text.length - 1) {

                text[parseInt(currentMap / 40) + 1].fontSize = currentMap % 40 + 20;
            }
          !isStop &&  webkitRequestAnimationFrame(render);
        }

        webkitRequestAnimationFrame(render);
         

         var arr = [
            './assets/images/card.png',
            './assets/images/figure.png',
            './assets/images/gy-bg.png',
            './assets/images/hu.png',
            './assets/images/hu1.png',
            './assets/images/hu-bg.png',
            './assets/images/index-bg.jpg',
            './assets/images/index-top.png',
            './assets/images/loading-bg.jpg',
            './assets/images/logo.png',
            './assets/images/none.png',
            './assets/images/board-bg.png',
            './assets/images/hand.png',
            './assets/images/paiming.png',
            './assets/images/r-bg.jpg',
            './assets/images/result-bg.png',
            './assets/images/result-bg1.png',
            './assets/images/right.png',
            './assets/images/shadow.png',
            './assets/images/user.png',
            './assets/images/2016.png',
        ];

        var scale = document.getElementById('l-loading-scale');

        loading(arr,function(data){
            scale.innerHTML = ((data*100 | 0)>90 ? 90 : (data*100 | 0))+'%';
        },function(){
            var s = document.createElement('script');
           // s.src = 'http://localhost:3000/index.js';//'./assets/js/index.js?t='+new Date().getTime();
            s.src = './assets/js/index.js?t='+new Date().getTime();
            document.body.appendChild(s);
            s.onload = function(){
                scale.innerHTML = '100%';
                document.querySelector('.fly-loading-C').classList.add('hide')
                isStop =  true;
            }
        });

     function  loading(arr, fn, fnEnd){
        var len = arr.length;
        var count = 0;
        var i = 0;
        
        function loadimg() {
            if (i === len) {
                return;
            }
            var img = new Image();
            img.onload = img.onerror = function(){
                count++;
                if (i < len - 1) {
                    i++;
                    loadimg();
                    fn && fn(i / (len - 1), img.src);
                } else {
                    fnEnd && fnEnd(img.src);
                }
            };
            img.src = arr[i];
        }
       loadimg();
    }

    function setSize(){
        var viewWidth = document.documentElement.clientWidth,
            viewHeight = document.documentElement.clientHeight;
            var canvas = document.getElementById('loading');
        canvas.width = viewWidth;
        canvas.height = viewHeight;
        return{viewWidth:viewWidth,viewHeight:viewHeight};
    }
 }(document);
</script>
    <script src='./assets/js/data.js'></script>
    <!-- <script src="./assets/js/index.js"></script> -->
<!--
    <script src="http://localhost:3000/index.js"></script>

-->

</body>
</html>